<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>{{ page_title }}</title>
<style>
    @page {
        size: A4;
        margin: 1.5cm;
    }
    body {
        font-family: 'Segoe UI', 'Noto Serif', serif;
        font-size: 10pt;
        max-width: 700px;
        margin: auto;
        color: #222;
        line-height: 1.4;
    }
    h1, h2 {
        font-weight: 700;
        color: #1A5276; /* Bleu foncé pour titres */
        margin-bottom: 12px;
    }
    header {
        text-align: center;
        margin-bottom: 25px;
    }
    header .logo {
        font-size: 28pt;
        font-weight: 900;
        color: #2980B9; /* Bleu ciel foncé */
        letter-spacing: 2px;
        margin-bottom: 5px;
    }
    .inventory-date {
        font-size: 9pt;
        color: #5D8AA8; /* Bleu gris clair */
        margin-bottom: 20px;
        text-align: center;
        font-style: italic;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        background: white;
        border: 1px solid #2980B9; /* bordure bleu ciel */
        margin-bottom: 1cm;
        font-size: 9pt;
    }
    thead {
        background: linear-gradient(90deg, #85C1E9, #2874A6); /* dégradé bleu ciel */
        color: white;
    }
    th, td {
        padding: 6px 8px;
        text-align: center;
        border-bottom: 1px solid #5499C7; /* bleu moyen pour bordure */
        border-right: 1px solid #5499C7;
    }
    th:last-child, td:last-child {
        border-right: none;
    }
    th:first-child, td:first-child {
        text-align: left;
    }
    .product-row td {
        font-weight: 600;
        background: #D6EAF8; /* bleu très clair */
    }
    .location-row td {
        background: #EBF5FB; /* bleu pastel très clair */
    }
    .total-row td {
        font-weight: 700;
        background: #EBF5FB;
        border-top: 2px solid #1A5276; /* bleu foncé */
        color: #1A5276;
    }
    .notes-section {
        margin-top: 30px;
        background: #EBF5FB;
        border-left: 4px solid #2980B9;
        padding: 12px 16px;
        border-radius: 4px;
        font-style: italic;
        color: #1A5276;
    }
    .main-header {
        background: #2874A6; /* bleu foncé */
        font-size: 10pt;
        font-weight: 700;
        color: white;
    }
    
    /* Section pour le total final */
    .final-total {
        margin-top: 30px;
        padding: 20px;
        background: #EBF5FB;
        border: 2px solid #2980B9;
        border-radius: 8px;
        text-align: center;
    }
    .final-total h3 {
        color: #1A5276;
        margin-bottom: 15px;
        font-size: 14pt;
    }
    .final-total .total-value {
        font-size: 18pt;
        font-weight: 900;
        color: #2874A6;
        background: white;
        padding: 10px 20px;
        border-radius: 4px;
        display: inline-block;
        border: 1px solid #2980B9;
    }
</style>
</head>
<body>
    <header>
        <div class="logo">ORALYS</div>
        <h1>{{ page_title }}</h1>
    </header>

    <div class="inventory-date">
        <div><strong>Valorisation au :</strong> {{ date }}</div>
    </div>

    <section>
        <h2>Détails de la Valorisation</h2>
        <table>
<thead>
    <tr>
        <th style="width: 20%;">Nom</th>
        <th style="width: 12%;">Réf.</th>
        <th style="width: 14%;">Catégorie</th>
        <th style="width: 12%;">Qté Totale</th>
        <th style="width: 15%;">Prix Total</th>
        <th colspan="2" class="main-header">Détails Stockage</th>
    </tr>
    <tr>
        <th></th>
        <th></th>
        <th></th>
        <th></th>
        <th></th>
        <th style="width: 17%; color: #3c2f2f;">Emplacement</th>
        <th style="width: 15%; color: #3c2f2f;">Prix</th>
    </tr>
</thead>
           <tbody>
    {% for product in products %}
    {% if product.locations %}
    {% for loc in product.locations %}
    <tr {% if forloop.first %}class="product-row"{% else %}class="location-row"{% endif %}>
        {% if forloop.first %}
        <td rowspan="{{ product.locations|length }}">{{ product.name }}</td>
        <td rowspan="{{ product.locations|length }}">{{ product.default_code|default:"N/A" }}</td>
        <td rowspan="{{ product.locations|length }}">{{ product.category|default:"N/A" }}</td>
        <td rowspan="{{ product.locations|length }}">{{ product.total_quantity|floatformat:2 }}</td>
        <td rowspan="{{ product.locations|length }}">{{ product.total_price|floatformat:2 }} MAD</td>
        {% endif %}
        <td>{{ loc.location_name }}</td>
        <td>{{ loc.location_price|floatformat:2 }} MAD</td>
    </tr>
    {% endfor %}
    {% else %}
    <tr class="product-row">
        <td>{{ product.name }}</td>
        <td>{{ product.default_code|default:"N/A" }}</td>
        <td>{{ product.category|default:"N/A" }}</td>
        <td>{{ product.total_quantity|floatformat:2 }}</td>
        <td>{{ product.total_price|floatformat:2 }} MAD</td>
        <td colspan="2" class="no-data">Aucun emplacement</td>
    </tr>
    {% endif %}
    {% empty %}
    <tr>
        <td colspan="7" class="no-data">Aucun produit</td>
    </tr>
    {% endfor %}
    
    <!-- Ligne de total à la fin du tableau -->
    <tr class="total-row">
        <td colspan="5">Total Stock :</td>
        <td colspan="2">{{ total_stock_value|floatformat:2 }} MAD</td>
    </tr>
</tbody>
        </table>
    </section>

</body>
</html>