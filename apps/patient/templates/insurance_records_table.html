<!-- Tableau avec style HR exact -->
<div class="table-responsive">
  <table class="table table-striped table-hover" id="tableInsurance">
    <thead class="table-light borderless">
      <tr class="main-row">
        <th class="d-none d-md-table-cell">
          <input type="checkbox" id="select-all-insurance">
        </th>
        <th class="sortable" data-sort="text">
          <div class="d-flex align-items-center">
            <span>Nom</span>
            <i class="fas fa-sort sort-icon ms-1 text-muted"></i>
          </div>
        </th>
        <th class="sortable d-none d-lg-table-cell" data-sort="text">
          <div class="d-flex align-items-center">
            <span>Prénom</span>
            <i class="fas fa-sort sort-icon ms-1 text-muted"></i>
          </div>
        </th>
        <th class="sortable d-none d-xl-table-cell" data-sort="text">
          <div class="d-flex align-items-center">
            <span>N° immatriculation</span>
            <i class="fas fa-sort sort-icon ms-1 text-muted"></i>
          </div>
        </th>
        <th class="sortable d-none d-xl-table-cell" data-sort="text">
          <div class="d-flex align-items-center">
            <span>N° affiliation</span>
            <i class="fas fa-sort sort-icon ms-1 text-muted"></i>
          </div>
        </th>
        <th class="sortable d-none d-xl-table-cell" data-sort="text">
          <div class="d-flex align-items-center">
            <span>Nom Adhérent</span>
            <i class="fas fa-sort sort-icon ms-1 text-muted"></i>
          </div>
        </th>
        <th class="sortable d-none d-xl-table-cell" data-sort="text">
          <div class="d-flex align-items-center">
            <span>Lien De Parenté</span>
            <i class="fas fa-sort sort-icon ms-1 text-muted"></i>
          </div>
        </th>
        <th class="sortable d-none d-lg-table-cell" data-sort="text">
          <div class="d-flex align-items-center">
            <span>Téléphone</span>
            <i class="fas fa-sort sort-icon ms-1 text-muted"></i>
          </div>
        </th>
        <th class="text-center">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for patient in patients %}
        <tr>
          <td data-label="Sélection" class="d-none d-md-table-cell">
            <input type="checkbox" class="row-check">
          </td>
          <td data-label="Nom">{{ patient.last_name|default:"-" }}</td>
          <td data-label="Prénom" class="d-none d-lg-table-cell">{{ patient.first_name|default:"-" }}</td>
          <td data-label="N° immatriculation" class="d-none d-xl-table-cell">{{ patient.insurance_number|default:"-" }}</td>
          <td data-label="N° affiliation" class="d-none d-xl-table-cell">{{ patient.affiliation_number|default:"-" }}</td>
          <td data-label="Nom adhérent" class="d-none d-xl-table-cell">{{ patient.insured_name|default:"-" }}</td>
          <td data-label="Lien de parenté" class="d-none d-xl-table-cell">{{ patient.relationship|default:"-" }}</td>
          <td data-label="Téléphone" class="d-none d-lg-table-cell">{{ patient.phone|default:"-" }}</td>
          <td data-label="Actions" class="actions-cell">
            <div class="d-flex gap-1 justify-content-end">
              <!-- Bouton voir plus (mobile uniquement) -->
              <button class="btn btn-sm btn-light border text-info d-lg-none" 
                      data-bs-toggle="modal" 
                      data-bs-target="#insuranceDetailsModal"
                      data-nom="{{ patient.last_name|default:'' }}"
                      data-prenom="{{ patient.first_name|default:'' }}"
                      data-insurance="{{ patient.insurance_number|default:'' }}"
                      data-affiliation="{{ patient.affiliation_number|default:'' }}"
                      data-adherent="{{ patient.insured_name|default:'' }}"
                      data-relation="{{ patient.relationship|default:'' }}"
                      data-telephone="{{ patient.phone|default:'' }}"
                      title="Voir Plus">
                <i class="fas fa-eye"></i>
              </button>
              <!-- Bouton imprimer -->
              <button class="btn btn-sm btn-light border text-primary" title="Imprimer">
                <i class="fas fa-print"></i>
              </button>
              <!-- Bouton modifier -->
              {% if request.session.user.permissions.patient.update %}
              <button class="btn btn-sm btn-light border text-dark edit-mutuelle-btn" 
                      data-id="{{ patient.id }}" 
                      title="Modifier">
                <i class="fas fa-edit"></i>
              </button>
              {% endif %}
            </div>
          </td>
        </tr>
      {% empty %}
        <tr id="insurance-no-results">
          <td colspan="9" class="text-center">Aucun Dossier D'Assurance</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Pagination Component - Style HR -->
<nav class="mt-3">
  <ul class="pagination justify-content-center flex-wrap" id="mutuellePagination">
    {% if patients.has_previous %}
      <li class="page-item">
        <a class="page-link" href="?page={{ patients.previous_page_number }}&search_mutuelle={{ search_mutuelle|default:'' }}" aria-label="Précédent">
          Préc
        </a>
      </li>
    {% else %}
      <li class="page-item disabled">
        <span class="page-link" aria-label="Précédent">
          Préc
        </span>
      </li>
    {% endif %}
    {% for num in paginator.page_range %}
      {% if patients.number == num %}
        <li class="page-item active">
          <span class="page-link">{{ num }}</span>
        </li>
      {% else %}
        <li class="page-item">
          <a class="page-link" href="?page={{ num }}&search_mutuelle={{ search_mutuelle|default:'' }}">{{ num }}</a>
        </li>
      {% endif %}
    {% endfor %}
    {% if patients.has_next %}
      <li class="page-item">
        <a class="page-link" href="?page={{ patients.next_page_number }}&search_mutuelle={{ search_mutuelle|default:'' }}" aria-label="Suivant">
          Suiv
        </a>
      </li>
    {% else %}
      <li class="page-item disabled">
        <span class="page-link" aria-label="Suivant">
          Suiv
        </span>
      </li>
    {% endif %}
  </ul>
</nav>
