<div id="patient-table-block">
    <div class="table-responsive">
        <table class="table table-striped table-hover" id="tablePatient">
            <thead class="table-light borderless">
                <tr class="main-row">
                    <th class="d-none d-md-table-cell">
                        <input type="checkbox" id="selectAll">
                    </th>
                    <th>
                        <span>Nom</span>
                    </th>
                    <th class="d-none d-md-table-cell">
                        <span>Prénom</span>
                    </th>
                    <th class="d-none d-md-table-cell">
                        <span>Médecin traitant</span>
                    </th>
                    <th class="d-none d-lg-table-cell">
                        <span>Sexe</span>
                    </th>
                    <th class="d-none d-lg-table-cell">
                        <span>Date de naissance</span>
                    </th>
                    <th class="d-none d-lg-table-cell">
                        <span>Téléphone</span>
                    </th>
                    <th class="text-center">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for patient in patients %}
                <tr>
                    <td data-label="Sélection" class="d-none d-md-table-cell">
                        <input type="checkbox" class="row-check" value="{{ patient.id }}">
                    </td>
                    <td data-label="Nom">
                        <div class="d-flex flex-column">
                            <span>{{ patient.last_name }}</span>
                            <small class="text-muted d-md-none">
                                {{ patient.first_name }} • {{ patient.get_gender_display }}
                                <br>{{ patient.birth_date|date:"d/m/Y" }} • {{ patient.mobile_number|default:patient.phone }}
                            </small>
                        </div>
                    </td>
                    <td data-label="Prénom" class="d-none d-md-table-cell">{{ patient.first_name }}</td>
                    <td data-label="Médecin traitant" class="d-none d-md-table-cell">
                        {% if patient.treating_physician %}
                            <span class="badge bg-primary">{{ patient.treating_physician }}</span>
                        {% else %}
                            <span class="text-muted">-</span>
                        {% endif %}
                    </td>
                    <td data-label="Sexe" class="d-none d-lg-table-cell">
                        <span class="badge {% if patient.gender == 'H' %}bg-info{% elif patient.gender == 'F' %}bg-pink{% else %}bg-secondary{% endif %}">
                            {{ patient.get_gender_display }}
                        </span>
                    </td>
                    <td data-label="Date de naissance" class="d-none d-lg-table-cell">{{ patient.birth_date|date:"d/m/Y" }}</td>
                    <td data-label="Téléphone" class="d-none d-lg-table-cell">
                        {% if patient.mobile_number or patient.phone %}
                            <span class="fw-bold text-success">{{ patient.mobile_number|default:patient.phone }}</span>
                        {% else %}
                            <span class="text-muted">-</span>
                        {% endif %}
                    </td>
                    <td data-label="Actions" class="actions-cell">
                        <div class="d-flex gap-1 justify-content-end">
                            {% if request.session.user.permissions.patient.update %}
                            <button type="button" class="btn btn-sm btn-light border text-dark edit-patient-btn" onclick="showEditPatientForm({{ patient.id }})" title="Modifier">
                                <i class="fas fa-edit"></i>
                            </button>
                        {% endif %}
                        {% if request.session.user.permissions.patient.delete %}
                            <button type="button" class="btn btn-sm btn-light border text-danger delete-patient-btn" data-patient-id="{{ patient.id }}" data-patient-name="{{ patient.last_name }} {{ patient.first_name }}" title="Supprimer">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                        {% endif %}
                            <button class="btn btn-sm btn-light border text-primary" title="Imprimer" onclick="window.print()">
                                <i class="fas fa-print"></i>
                            </button>
                            <button class="btn btn-sm btn-light border text-info view-patient-details-btn d-lg-none" title="Voir détails" data-patient-id="{{ patient.id }}" data-patient-name="{{ patient.last_name }} {{ patient.first_name }}" data-patient-phone="{{ patient.mobile_number|default:patient.phone }}" data-patient-birth="{{ patient.birth_date|date:'d/m/Y' }}" data-patient-gender="{{ patient.get_gender_display }}" data-patient-medecin="{{ patient.treating_physician|default:'-' }}">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="8" class="text-center py-5">
                        <div class="d-flex flex-column align-items-center text-muted">
                            <i class="fas fa-user-injured fa-3x mb-3 opacity-50"></i>
                            <h5 class="text-muted">Aucun patient enregistré</h5>
                            <p class="mb-0">Aucun patient n'a été trouvé avec les critères sélectionnés.</p>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <!-- Pagination -->
    {% with next_param=request.GET.next|default:'' %}
    {% if paginator and paginator.num_pages > 1 %}
    <div class="pagination-container mt-4">
        <nav aria-label="Pagination patients">
            <ul class="pagination justify-content-center" id="patientPagination">
                {% if patients.has_previous %}
                    <li class="page-item"><a class="page-link page-ajax" href="?page={{ patients.previous_page_number }}{% if next_param %}&next={{ next_param }}{% endif %}">&laquo; Préc</a></li>
                {% else %}
                    <li class="page-item disabled"><span class="page-link">&laquo; Préc</span></li>
                {% endif %}
                {% for num in paginator.page_range %}
                    {% if patients.number == num %}
                        <li class="page-item active"><span class="page-link">{{ num }}</span></li>
                    {% else %}
                        <li class="page-item"><a class="page-link page-ajax" href="?page={{ num }}{% if next_param %}&next={{ next_param }}{% endif %}">{{ num }}</a></li>
                    {% endif %}
                {% endfor %}
                {% if patients.has_next %}
                    <li class="page-item"><a class="page-link page-ajax" href="?page={{ patients.next_page_number }}{% if next_param %}&next={{ next_param }}{% endif %}">Suiv &raquo;</a></li>
                {% else %}
                    <li class="page-item disabled"><span class="page-link">Suiv &raquo;</span></li>
                {% endif %}
            </ul>
        </nav>
    </div>
    {% endif %}
    {% endwith %}
</div> 