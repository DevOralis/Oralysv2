{% extends 'base.html' %}
{% load static %}
{% block title %}Dossiers Mutuelle / Assurance{% endblock %}
{% block menu %}
  {% include 'patient_menu.html' %}
{% endblock %}
{% block extra_scripts %}
  <script src="{% static 'vendor/js/sweetalert2@11.js' %}"></script>
  <script src="{% static 'vendor/js/bootstrap.bundle.min.js' %}"></script>
  <script src="{% static 'js/insurance_records.js' %}"></script>
{% endblock %}
{% block content %}
<div class="content">
  <div class="card">
    <div class="card-header text-white" style="background-color: #1e90ff;">
      <i class="fas fa-shield-alt me-2"></i>
      Dossiers D'Assurance
    </div>
    <div class="card-body p-3">
      <!-- Barre de recherche et bouton d'export - Style HR -->
      <form method="get" id="search-form-insurance">
        <div class="row g-2 mb-3">
          <!-- Barre de recherche -->
          <div class="col-12 col-sm-12 col-md-8 col-lg-8 order-1">
            <div class="input-group">
              <span class="input-group-text text-white border-primary" style="background-color: #1e90ff;">
                <i class="fas fa-search"></i>
              </span>
              <input type="search" id="search-mutuelle" class="form-control border-primary" placeholder="Rechercher Un Patient..." value="{{ request.GET.search_mutuelle|default:'' }}">
            </div>
          </div>
          <!-- Boutons d'action -->
          <div class="col-12 col-sm-12 col-md-4 col-lg-4 order-2">
            <div class="d-flex gap-1">
              <button type="button" id="export-import-btn" class="btn btn-light border w-100 text-nowrap px-2">
                <i class="fas fa-file-import" id="export-import-icon"></i>
                <span class="ms-1" id="export-import-text">Importer</span>
              </button>
            </div>
          </div>
        </div>
      </form>

      <!-- Tableau des dossiers d'assurance -->
      <div id="dossier-mutuelle-table-block">
        {% include 'insurance_records_table.html' %}
      </div>
    </div>
  </div>

  <!-- Conteneur pour le formulaire d'édition -->
  <div id="mutuelle-edit-form-container" style="display: none;">
    {% include 'insurance_edit_form.html' %}
  </div>
</div>

<!-- Modal pour les détails de l'assurance - EN DEHORS du block AJAX -->
<div class="modal fade" id="insuranceDetailsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">
                    <i class="fas fa-shield-alt me-2"></i>Détails De L'Assurance
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-3">
                <div class="mb-2">
                    <strong>Nom :</strong> <span id="modal-nom">-</span>
                </div>
                <div class="mb-2">
                    <strong>Prénom :</strong> <span id="modal-prenom">-</span>
                </div>
                <div class="mb-2">
                    <strong>N° immatriculation :</strong> <span id="modal-insurance">-</span>
                </div>
                <div class="mb-2">
                    <strong>N° affiliation :</strong> <span id="modal-affiliation">-</span>
                </div>
                <div class="mb-2">
                    <strong>Nom De L'Adhérent :</strong> <span id="modal-adherent">-</span>
                </div>
                <div class="mb-2">
                    <strong>Lien De Parenté :</strong> <span id="modal-relation">-</span>
                </div>
                <div class="mb-0">
                    <strong>Téléphone :</strong> <span id="modal-telephone">-</span>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}
