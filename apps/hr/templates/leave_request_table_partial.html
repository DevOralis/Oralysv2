<div class="table-responsive hr-capitalize">
    <table class="table table-hover bg-white align-middle" id="leaveRequestTable">
        <thead class="bg-gradient-primary text-white">
            <tr>
                <th class="border-0 fw-semibold d-none d-md-table-cell">
                    <input type="checkbox" id="selectAllLeaveRequests">
                </th>
                <th class="border-0 fw-semibold sortable" data-sort="leave_type" style="cursor: pointer;">
                    <div class="d-flex align-items-center justify-content-between">
                        <span>Type de congé</span>
                        <i class="fas fa-sort sort-icon text-muted"></i>
                    </div>
                </th>
                <th class="border-0 fw-semibold d-none d-lg-table-cell sortable" data-sort="employee" style="cursor: pointer;">
                    <div class="d-flex align-items-center justify-content-between">
                        <span>Employé</span>
                        <i class="fas fa-sort sort-icon text-muted"></i>
                    </div>
                </th>
                <th class="border-0 fw-semibold d-none d-lg-table-cell sortable" data-sort="start_date" style="cursor: pointer;">
                    <div class="d-flex align-items-center justify-content-between">
                        <span>Date de début</span>
                        <i class="fas fa-sort sort-icon text-muted"></i>
                    </div>
                </th>
                <th class="border-0 fw-semibold d-none d-lg-table-cell sortable" data-sort="end_date" style="cursor: pointer;">
                    <div class="d-flex align-items-center justify-content-between">
                        <span>Date de fin</span>
                        <i class="fas fa-sort sort-icon text-muted"></i>
                    </div>
                </th>
                <th class="border-0 fw-semibold d-none d-lg-table-cell sortable" data-sort="duration" style="cursor: pointer;">
                    <div class="d-flex align-items-center justify-content-between">
                        <span>Durée</span>
                        <i class="fas fa-sort sort-icon text-muted"></i>
                    </div>
                </th>
                <th class="border-0 fw-semibold d-none d-lg-table-cell sortable" data-sort="status" style="cursor: pointer;">
                    <div class="d-flex align-items-center justify-content-between">
                        <span>Statut</span>
                        <i class="fas fa-sort sort-icon text-muted"></i>
                    </div>
                </th>
                <th class="border-0 fw-semibold d-none d-xl-table-cell sortable" data-sort="request_date" style="cursor: pointer;">
                    <div class="d-flex align-items-center justify-content-between">
                        <span>Date de demande</span>
                        <i class="fas fa-sort sort-icon text-muted"></i>
                    </div>
                </th>
                <th class="border-0 fw-semibold d-none d-xl-table-cell">Avis Chef</th>

                <th class="border-0 fw-semibold d-none d-xl-table-cell">Décideur</th>
                <th class="border-0 fw-semibold text-center">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for request in leave_requests %}
            <tr class="border-bottom">
                <td data-label="Sélection" class="d-none d-md-table-cell">
                    <input type="checkbox" class="row-check" value="{{ request.id }}">
                </td>
                <td class="fw-medium text-primary" data-label="Type de congé">
                    <div class="d-flex flex-column">
                        <div class="d-lg-none">
                            <strong class="text-muted">Type de congé</strong>
                        </div>
                        <span>{{ request.leave_type.name }}</span>
                        <small class="text-muted d-lg-none">
                            <span class="badge rounded-pill me-1
                                {% if request.status == 'draft' %}bg-secondary
                                {% elif request.status == 'submitted' %}bg-info
                                {% elif request.status == 'approved' %}bg-success
                                {% elif request.status == 'refused' %}bg-danger
                                {% else %}bg-warning{% endif %}">
                                {{ request.get_status_display }}
                            </span>
                            {{ request.start_date|date:"d/m/Y" }} - {{ request.end_date|date:"d/m/Y" }} ({{ request.duration }}j)
                        </small>
                    </div>
                </td>
                <td class="d-none d-lg-table-cell" data-label="Employé">{{ request.employee.full_name }}</td>
                <td class="d-none d-lg-table-cell text-muted" data-label="Date de début">{{ request.start_date|date:"d/m/Y" }}</td>
                <td class="d-none d-lg-table-cell text-muted" data-label="Date de fin">{{ request.end_date|date:"d/m/Y" }}</td>
                <td class="d-none d-lg-table-cell" data-label="Durée">
                    <span class="badge bg-light text-dark border">{{ request.duration }} jour{{ request.duration|pluralize }}</span>
                </td>
                <td class="d-none d-lg-table-cell" data-label="Statut">
                    <span class="badge rounded-pill
                        {% if request.status == 'draft' %}bg-secondary
                        {% elif request.status == 'submitted' %}bg-info
                        {% elif request.status == 'approved' %}bg-success
                        {% elif request.status == 'refused' %}bg-danger
                        {% else %}bg-warning{% endif %}">
                        {{ request.get_status_display }}
                    </span>
                </td>
                <td class="d-none d-xl-table-cell text-muted small" data-label="Date de demande">{{ request.request_date|date:"d/m/Y H:i" }}</td>
                <td class="d-none d-xl-table-cell" data-label="Avis Chef">
                    {% if request.manager_decision == 'approved' %}
                        <span class="badge bg-success">Oui</span>
                    {% elif request.manager_decision == 'refused' %}
                        <span class="badge bg-danger">Non</span>
                    {% else %}
                        <span class="badge bg-secondary">En attente</span>
                    {% endif %}
                </td>

                <td class="d-none d-xl-table-cell">
                    {% if request.approval %}
                        <div class="d-flex align-items-center">
                            <div class="avatar-sm bg-primary rounded-circle d-flex align-items-center justify-content-center me-2">
                                <i class="fas fa-user text-white small"></i>
                            </div>
                            <span class="small">{{ request.approval.employee.full_name }}</span>
                        </div>
                    {% else %}
                        <span class="text-muted">-</span>
                    {% endif %}
                </td>
                <td class="text-center">
                    <div class="d-lg-none mb-2">
                        <strong class="text-muted">Actions</strong>
                    </div>
                    <div class="d-flex gap-1 justify-content-center">
                        {% if request.status == 'draft' %}
                            <button class="btn btn-sm btn-light border text-success submitRequest action-button" data-id="{{ request.request_id }}" title="Soumettre">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                            <button class="btn btn-sm btn-light border text-dark editRequest action-button" data-id="{{ request.request_id }}" title="Modifier">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-light border text-danger deleteRequest action-button" data-id="{{ request.request_id }}" title="Supprimer">
                                <i class="fas fa-trash"></i>
                            </button>
                        {% elif request.status == 'submitted' %}
                            {% if manager_mode %}
                                <button class="btn btn-sm btn-light border text-success managerDecision" data-decision="approved" data-id="{{ request.request_id }}" title="Avis favorable">
                                    <i class="fas fa-check"></i>
                                </button>
                                <button class="btn btn-sm btn-light border text-danger managerDecision" data-decision="refused" data-id="{{ request.request_id }}" title="Avis défavorable">
                                    <i class="fas fa-times"></i>
                                </button>
                            {% else %}
                                <button class="btn btn-sm btn-light border text-dark editRequest action-button" data-id="{{ request.request_id }}" title="Modifier">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-light border text-danger cancelRequest action-button" data-id="{{ request.request_id }}" title="Annuler">
                                    <i class="fas fa-ban"></i>
                                </button>
                            {% endif %}
                        {% else %}
                            <button class="btn btn-sm btn-light border text-info viewRequest action-button" data-id="{{ request.request_id }}" title="Voir les détails">
                                <i class="fas fa-eye"></i>
                            </button>
                        {% endif %}
                    </div>
                </td>
            </tr>
            {% empty %}
            <tr class="empty-row">
                <td colspan="10" class="text-center py-5">
                    <div class="d-flex flex-column align-items-center text-muted">
                        <i class="fas fa-calendar-times fa-3x mb-3 opacity-50"></i>
                        <h5 class="text-muted">Aucune demande de congé</h5>
                        <p class="mb-0">Aucune demande n'a été trouvée avec les critères sélectionnés.</p>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>